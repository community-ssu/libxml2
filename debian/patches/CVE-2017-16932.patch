Index: libxml2-2.8.0+dfsg1/parser.c
===================================================================
--- libxml2-2.8.0+dfsg1.orig/parser.c	2017-11-26 17:00:14.144921033 +0100
+++ libxml2-2.8.0+dfsg1/parser.c	2017-11-26 17:05:16.997906119 +0100
@@ -2199,6 +2199,13 @@
 	xmlGenericError(xmlGenericErrorContext,
 		"Pushing input %d : %.30s\n", ctxt->inputNr+1, input->cur);
     }
+    if (((ctxt->inputNr > 40) && ((ctxt->options & XML_PARSE_HUGE) == 0)) ||
+        (ctxt->inputNr > 1024)) {
+        xmlFatalErr(ctxt, XML_ERR_ENTITY_LOOP, NULL);
+        while (ctxt->inputNr > 1)
+            xmlFreeInputStream(inputPop(ctxt));
+	return(-1);
+    }
     ret = inputPush(ctxt, input);
     if (ctxt->instate == XML_PARSER_EOF)
         return(-1);
@@ -7958,8 +7965,11 @@
 	     * c.f. http://www.w3.org/TR/REC-xml#as-PE
 	     */
 	    input = xmlNewEntityInputStream(ctxt, entity);
-	    if (xmlPushInput(ctxt, input) < 0)
-		return;
+            if (xmlPushInput(ctxt, input) < 0) {
+                 xmlFreeInputStream(input);
+                return;
+            }
+
 	    if ((entity->etype == XML_EXTERNAL_PARAMETER_ENTITY) &&
 		(CMP5(CUR_PTR, '<', '?', 'x', 'm', 'l')) &&
 		(IS_BLANK_CH(NXT(5)))) {
Index: libxml2-2.8.0+dfsg1/result/errors/759579.xml.err
===================================================================
--- /dev/null	1970-01-01 00:00:00.000000000 +0000
+++ libxml2-2.8.0+dfsg1/result/errors/759579.xml.err	2017-11-26 17:00:14.140920809 +0100
@@ -0,0 +1,6 @@
+Entity: line 2: parser error : Detected an entity reference loop
+        %z; %z; %z; %z; %z;
+           ^
+Entity: line 2: 
+        %z; %z; %z; %z; %z;
+           ^
Index: libxml2-2.8.0+dfsg1/result/errors/759579.xml.str
===================================================================
--- /dev/null	1970-01-01 00:00:00.000000000 +0000
+++ libxml2-2.8.0+dfsg1/result/errors/759579.xml.str	2017-11-26 17:00:14.140920809 +0100
@@ -0,0 +1,7 @@
+Entity: line 2: parser error : Detected an entity reference loop
+        %z; %z; %z; %z; %z;
+           ^
+Entity: line 2: 
+        %z; %z; %z; %z; %z;
+           ^
+./test/errors/759579.xml : failed to parse
Index: libxml2-2.8.0+dfsg1/test/errors/759579.xml
===================================================================
--- /dev/null	1970-01-01 00:00:00.000000000 +0000
+++ libxml2-2.8.0+dfsg1/test/errors/759579.xml	2017-11-26 17:00:14.140920809 +0100
@@ -0,0 +1,11 @@
+<!DOCTYPE doc [
+    <!ENTITY % z '
+        &#37;z; &#37;z; &#37;z; &#37;z; &#37;z;
+        &#37;z; &#37;z; &#37;z; &#37;z; &#37;z;
+        &#37;z; &#37;z; &#37;z; &#37;z; &#37;z;
+        &#37;z; &#37;z; &#37;z; &#37;z; &#37;z;
+        &#37;z; &#37;z; &#37;z; &#37;z; &#37;z;
+    '>
+    %z;
+]>
+<doc/>
